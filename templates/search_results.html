{% extends 'base.html' %}

{% block title %}Search Results{% endblock %}

{% block content %}
<div class="container mb-5">

    <div class="text-center my-4">
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">üè† Back to Home</a>
    </div>
    
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ messages[0] }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>      
    {% endif %}
    {% endwith %}

    <h2 class="mb-4">üîé Results for "{{ query }}"</h2>

    {% if results %}
        <div class="row g-3">
            {% for slot in results %}
                {% if slot[9] != 'deleted' %}
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-body d-flex flex-column justify-content-between">

                            <div>
                                <div class="mb-2">
                                    <small class="text-muted">ID: #<strong>{{ slot[0] }}</strong></small>
                                </div>

                                <h6 class="card-title">{{ slot[4] }}</h6>

                                <p class="card-text small mb-1">
                                    <strong>By:</strong> {{ slot[1] }}<br>
                                    <strong>üì±</strong> {{ slot[2] }}<br>
                                    <strong>üìß</strong> {{ slot[3] }}<br>
                                    <strong>Date:</strong> {{ slot[5] }}<br>
                                    <strong>Time:</strong> {{ slot[6] }}
                                </p>

                                {% if slot[9] == 'completed' %}
                                    <div class="badge bg-success mb-2">‚úÖ Completed</div>
                                {% endif %}
                                
                                {% if slot[7] == 'PAID' %}
                                    <p class="text-success mb-0">‚Çπ{{ slot[8] }} Paid</p>
                                {% else %}
                                    <p class="text-danger mb-0">Unpaid</p>
                                {% endif %}
                            </div>

                            {% if slot[7] == 'UNPAID' %}
                                <button class="btn btn-success mt-3 btn-sm" data-bs-toggle="modal" data-bs-target="#payModal{{ slot[0] }}">
                                    üí≥ Pay
                                </button>
                            {% elif slot[7] == 'PAID' %}
                                <button class="btn btn-secondary mt-3 btn-sm" disabled>‚úÖ Paid</button>
                            {% endif %}

                        </div>
                    </div>
                </div>

                {% include 'components/payment_modal.html' %}
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No matching slots found.</p>
    {% endif %}

</div>
{% endblock %}
